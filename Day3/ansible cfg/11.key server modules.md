Hereâ€™s a Hands-on Ansible Playbook Lab designed for learners to progress from simple tasks to more advanced concepts. This lab assumes the learner is using Ubuntu localhost or a target Ubuntu VM, and has Ansible installed.

ğŸ§ª Ansible Lab: From Simple to Advanced (Ubuntu)

ğŸ—‚ï¸ Directory Structure (Best Practice)

ansible-lab/
â”œâ”€â”€ ansible.cfg
â”œâ”€â”€ inventory.ini
â”œâ”€â”€ playbooks/
â”‚   â”œâ”€â”€ 01-basic-setup.yml
â”‚   â”œâ”€â”€ 02-user-management.yml
â”‚   â”œâ”€â”€ 03-file-copying.yml
â”‚   â”œâ”€â”€ 04-template-demo.yml
â”‚   â”œâ”€â”€ 05-service-control.yml
â”‚   â”œâ”€â”€ 06-facts-debug.yml
â”‚   â””â”€â”€ 07-advanced-config.yml
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ nginx.conf.j2
â”œâ”€â”€ files/
â”‚   â””â”€â”€ index.html
â””â”€â”€ group_vars/
    â””â”€â”€ all.yml

ğŸ§© ansible.cfg (Basic Config)

[defaults]
inventory = inventory.ini
remote_user = ubuntu
host_key_checking = False
retry_files_enabled = False

ğŸ”¢ inventory.ini (Static Inventory)

[webservers]
localhost ansible_connection=local

ğŸ”§ 1. playbooks/01-basic-setup.yml â€” Install and Update Packages

- name: Basic System Setup
  hosts: webservers
  become: yes
  tasks:
    - name: Update APT cache
      apt:
        update_cache: yes

    - name: Install Nginx
      apt:
        name: nginx
        state: present

ğŸ‘¤ 2. playbooks/02-user-management.yml â€” Create a User

- name: User Management
  hosts: webservers
  become: yes
  tasks:
    - name: Create ansible_admin user
      user:
        name: ansible_admin
        shell: /bin/bash
        state: present

ğŸ“ 3. playbooks/03-file-copying.yml â€” Copy a Static HTML File

Place an HTML file in files/index.html.

- name: Copy Web Page
  hosts: webservers
  become: yes
  tasks:
    - name: Copy index.html to web server root
      copy:
        src: files/index.html
        dest: /var/www/html/index.html
        mode: '0644'

ğŸ§¾ 4. playbooks/04-template-demo.yml â€” Templating Nginx Config

templates/nginx.conf.j2

user www-data;
worker_processes auto;
pid /run/nginx.pid;

events {
    worker_connections 768;
}

http {
    server {
        listen 80;
        server_name {{ inventory_hostname }};
        location / {
            root /var/www/html;
            index index.html;
        }
    }
}

Playbook

- name: Template Nginx Config
  hosts: webservers
  become: yes
  tasks:
    - name: Deploy Nginx config using template
      template:
        src: templates/nginx.conf.j2
        dest: /etc/nginx/nginx.conf
        mode: '0644'

    - name: Restart Nginx
      service:
        name: nginx
        state: restarted

ğŸ’¡ 5. playbooks/05-service-control.yml â€” Service and Firewall

- name: Manage Services
  hosts: webservers
  become: yes
  tasks:
    - name: Ensure nginx is enabled and running
      service:
        name: nginx
        state: started
        enabled: yes

    - name: Allow UFW for port 80
      ufw:
        rule: allow
        port: '80'
        proto: tcp

ğŸ§  6. playbooks/06-facts-debug.yml â€” Gather Facts and Debug

- name: Gather and Show Facts
  hosts: webservers
  tasks:
    - name: Print OS Distribution
      debug:
        msg: "This system is running {{ ansible_distribution }} {{ ansible_distribution_version }}"

    - name: Print IP Address
      debug:
        msg: "IP address: {{ ansible_default_ipv4.address }}"

âš™ï¸ 7. playbooks/07-advanced-config.yml â€” Advanced: Users + Line Edit + Assert

- name: Advanced Configuration
  hosts: webservers
  become: yes
  tasks:
    - name: Ensure sshd_config disables root login
      lineinfile:
        path: /etc/ssh/sshd_config
        regexp: '^PermitRootLogin'
        line: 'PermitRootLogin no'
        backup: yes

    - name: Assert root login is disabled
      assert:
        that:
          - "'PermitRootLogin no' in lookup('file', '/etc/ssh/sshd_config')"
        fail_msg: "Root login not disabled!"
        success_msg: "Root login successfully disabled."

    - name: Restart SSH service
      service:
        name: ssh
        state: restarted

ğŸ“¦ group_vars/all.yml â€” Global Variables

nginx_port: 80
admin_user: ansible_admin

âœ… Running the Lab

From the ansible-lab directory, run playbooks one by one:

ansible-playbook playbooks/01-basic-setup.yml
ansible-playbook playbooks/02-user-management.yml
...



ğŸ”§ Updated Directory Structure

We will add one more playbook and include these modules in it.

ansible-lab/
â”œâ”€â”€ ansible.cfg
â”œâ”€â”€ inventory.ini
â”œâ”€â”€ playbooks/
â”‚   â”œâ”€â”€ 08-extras.yml  â† NEW

ğŸ“˜ New Playbook: playbooks/08-extras.yml

- name: Exercise - Misc Modules
  hosts: webservers
  become: yes
  vars:
    test_file: /tmp/ansible-test.txt
    git_repo: https://github.com/hashicorp/learn-terraform-provision-nginx.git

  tasks:

    - name: Use command module to list files
      command: ls -l /tmp
      register: ls_output

    - name: Debug output of ls command
      debug:
        var: ls_output.stdout_lines

    - name: Use shell module to create a test file with echo
      shell: echo "This is created by Ansible shell module" > {{ test_file }}

    - name: Use lineinfile to add line to test file
      lineinfile:
        path: "{{ test_file }}"
        line: "Line added by Ansible lineinfile"

    - name: Clone a public Git repository
      git:
        repo: "{{ git_repo }}"
        dest: /tmp/terraform-nginx
        version: main

    - name: Download a file using get_url
      get_url:
        url: https://raw.githubusercontent.com/vim/vim/master/README.md
        dest: /tmp/vim-readme.md

    - name: Final Debug message
      debug:
        msg: |
          All tasks completed.
          You can check:
          - The file at {{ test_file }}
          - The Git repo at /tmp/terraform-nginx
          - Downloaded file at /tmp/vim-readme.md

ğŸ§ª What This Exercise Teaches Participants

Module	Purpose
command	Runs a raw command without a shell interpreter
shell	Runs a shell command (useful for piping, redirects, etc.)
debug	Print variable or message to help understand play execution
git	Clone or update Git repositories
get_url	Downloads files over HTTP/HTTPS
lineinfile	Edits files line-by-line, ensuring idempotency

ğŸƒâ€â™‚ï¸ To Run

From the root directory of the lab:

ansible-playbook playbooks/08-extras.yml

